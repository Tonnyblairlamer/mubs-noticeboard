<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MUBS Staff – Digital Noticeboard (Single Page)</title>
  
  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root{ --bg:#f8fafc; --text:#0f172a; --muted:#475569; --card:#ffffff; --border:#e2e8f0; --accent:#0d6efd; --accent-contrast:#ffffff; --chip:#e7efff; }
    [data-theme="dark"]{ --bg:#0a1128; --text:#f8fafc; --muted:#cbd5e1; --card:#0f172a; --border:#1e293b; --accent:#facc15; --accent-contrast:#111827; --chip:#1f2a44; }

    html,body{height:100%}
    body{background:var(--bg);color:var(--text)}

    .app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
    @media (max-width: 991.98px){.app{grid-template-columns:1fr}}

    .sidebar{background:var(--card);border-right:1px solid var(--border)}
    .brand{padding:1rem 1.25rem;border-bottom:1px solid var(--border)}
    .logo{width:38px;height:38px;border-radius:10px;background:transparent;color:var(--accent-contrast);display:grid;place-items:center;font-weight:700;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:contain;padding:4px}
    .profile{padding:1rem 1.25rem;border-bottom:1px solid var(--border);text-align:center}
    .avatar{width:70px;height:70px;border-radius:50%;display:grid;place-items:center;background:var(--border);color:var(--text);font-weight:700;font-size:1.5rem;margin:0 auto;overflow:hidden}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .sidebar .nav-link{color:var(--text);border-radius:.65rem}
    .sidebar .nav-link.active,.sidebar .nav-link:hover{background:var(--chip)}

    @media (max-width: 991.98px){.sidebar{display:none}}

    .content{padding:1rem 1rem 5rem}
    @media (min-width: 992px){.content{padding:1.5rem 2rem 3rem}}

    .topbar{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:.75rem}

    .card-soft{background:var(--card);border:1px solid var(--border);border-radius:1rem}
    .btn-primary{background:var(--accent);border-color:var(--accent);color:var(--accent-contrast)}
    .btn-outline-secondary{border-color:var(--border);color:var(--text)}

    .badge-status{border:1px solid var(--border);}

    .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:none;z-index:1030}
    .bottom-nav .nav-link{flex:1;text-align:center;color:var(--text);padding:.5rem 0}
    .bottom-nav .nav-link.active{color:var(--accent)}
    @media (max-width: 991.98px){.bottom-nav{display:flex}}
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand d-flex align-items-center gap-2">
        <div class="logo">
          <img src="mubs.png" alt="MUBS Logo" onerror="this.style.display='none'; this.parentElement.innerHTML='M';">
        </div>
        <div>
          <div class="fw-bold">MUBS Noticeboard</div>
          <div class="small muted">Staff Panel</div>
        </div>
      </div>
      <div class="profile">
        <div class="avatar" id="sidebarAvatar">ST</div>
        <div class="fw-semibold mt-2" id="sidebarName">Staff Name</div>
        <div class="xsmall muted" id="sidebarDept">Department</div>
      </div>
      <nav class="nav flex-column p-2">
        <a class="nav-link active" data-link="myNotices" href="#"><i class="bi bi-megaphone me-2"></i>My Notices</a>
        <a class="nav-link" data-link="create" href="#"><i class="bi bi-plus-circle me-2"></i>Create Notice</a>
        <a class="nav-link" data-link="profile" href="#"><i class="bi bi-person me-2"></i>Profile</a>
        <hr>
        <button id="toggleThemeSide" class="btn btn-sm btn-outline-secondary w-100 mb-2"><i class="bi bi-moon me-1"></i> Toggle Theme</button>
        <button class="btn btn-sm btn-outline-danger w-100" onclick="logout()"><i class="bi bi-box-arrow-right me-1"></i> Logout</button>
      </nav>
    </aside>

    <!-- Content -->
    <main class="content">
      <div class="topbar d-flex flex-wrap align-items-center gap-2 mb-4">
        <!-- Mobile Logo and Profile -->
        <div class="d-md-none d-flex align-items-center gap-2">
          <!-- Mobile Profile Picture -->
          <div class="avatar" id="topbarProfileAvatar" style="width: 36px; height: 36px; border-radius: 999px; display: grid; place-items: center; background: var(--border); color: var(--text); font-weight: 700; flex-shrink: 0; cursor: pointer; overflow: hidden; position: relative;" data-link="profile">
            <img id="topbarProfileImg" src="" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; border-radius: 999px; display: none; position: absolute;">
          </div>
          <div class="logo" style="width: 32px; height: 32px;">
            <img src="mubs.png" alt="MUBS Logo" onerror="this.style.display='none'; this.parentElement.innerHTML='M';" style="width: 100%; height: 100%; object-fit: contain;">
          </div>
          <div class="fw-bold small">MUBS</div>
        </div>
        <div class="input-group flex-grow-1">
          <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
          <input class="form-control border-0" id="searchInput" placeholder="Search my notices..." />
        </div>
        <div class="ms-auto d-flex gap-2">
          <button id="toggleThemeTop" class="btn btn-outline-secondary"><i class="bi bi-sun"></i></button>
          <a class="btn btn-primary" data-link="create">+ Create</a>
        </div>
      </div>

      <!-- Sections -->

      <!-- My Notices -->
      <section id="section-myNotices">
        <div class="card-soft p-3 mb-3 d-flex justify-content-between align-items-center">
          <div class="fw-semibold">My Posted Notices</div>
          <div class="d-flex gap-2">
            <select id="statusFilter" class="form-select form-select-sm">
              <option value="all">All Statuses</option>
              <option value="draft">Draft</option>
              <option value="pending">Pending</option>
              <option value="published">Published</option>
              <option value="archived">Archived</option>
            </select>
            <select id="categoryFilter" class="form-select form-select-sm">
              <option value="all">All Categories</option>
              <option>Academics</option>
              <option>Examinations</option>
              <option>Events</option>
              <option>ICT</option>
              <option>General</option>
            </select>
          </div>
        </div>

        <!-- Desktop table -->
        <div class="table-responsive card-soft d-none d-md-block">
          <table class="table align-middle mb-0">
            <thead>
              <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Status</th>
                <th>Created</th>
                <th>Publish</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody id="tableMyNotices"></tbody>
          </table>
        </div>

        <!-- Mobile cards -->
        <div class="row g-3 d-md-none" id="cardsMyNotices"></div>
      </section>

      <!-- Create / Edit Notice -->
      <section id="section-create" hidden>
        <h4 class="fw-bold mb-3" id="formTitle">Create Notice</h4>
        <form id="noticeForm" class="card-soft p-4">
          <input type="hidden" id="noticeId">
          <div class="row g-3">
            <div class="col-md-8">
              <label class="form-label">Title</label>
              <input id="n_title" class="form-control" maxlength="200" required />
            </div>
            <div class="col-md-4">
              <label class="form-label">Category</label>
              <select id="n_category" class="form-select" required>
                <option value="">Select…</option>
                <option>Academics</option>
                <option>Examinations</option>
                <option>Events</option>
                <option>ICT</option>
                <option>General</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Department</label>
              <input id="n_department" class="form-control" placeholder="e.g., Academic Registrar" required />
            </div>
            <div class="col-md-4">
              <label class="form-label">Status</label>
              <select id="n_status" class="form-select">
                <option value="draft">Draft</option>
                <option value="pending">Pending</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Pin</label>
              <select id="n_pinned" class="form-select">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Publish At</label>
              <input id="n_publish_at" type="datetime-local" class="form-control" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Expire At</label>
              <input id="n_expire_at" type="date" class="form-control" />
            </div>
            <div class="col-12">
              <label class="form-label">Content</label>
              <textarea id="n_content" class="form-control" rows="8" required placeholder="Write the notice…"></textarea>
            </div>
          </div>
          <div class="d-flex justify-content-end gap-2 mt-3">
            <button type="button" class="btn btn-outline-secondary" id="btnCancel">Cancel</button>
            <button type="button" class="btn btn-warning" id="btnSaveDraft">Save Draft</button>
            <button type="submit" class="btn btn-primary" id="btnPublish">Save</button>
          </div>
        </form>
      </section>

      <!-- Profile -->
      <section id="section-profile" hidden>
        <h4 class="fw-bold mb-3">Profile</h4>
        <form id="profileForm" class="card-soft p-4 text-center">
          <div class="mb-3">
            <div class="avatar mb-3" id="profileAvatar">ST</div>
            <input type="file" id="photoInput" accept="image/*" class="form-control form-control-sm" style="max-width:300px;margin:auto">
          </div>
          <div class="row g-3 text-start">
            <div class="col-md-6">
              <label class="form-label">Full Name</label>
              <input id="p_name" class="form-control" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Department</label>
              <input id="p_dept" class="form-control" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input id="p_email" type="email" class="form-control" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Phone</label>
              <input id="p_phone" class="form-control" />
            </div>
          </div>
          <div class="d-flex justify-content-end gap-2 mt-3">
            <button type="button" class="btn btn-outline-secondary" id="resetProfile">Reset</button>
            <button class="btn btn-primary">Save Profile</button>
          </div>
        </form>
      </section>

    </main>
  </div>

  <!-- Bottom navbar (mobile) -->
  <nav class="bottom-nav">
    <a class="nav-link active" data-link="myNotices" href="#"><i class="bi bi-megaphone fs-5 d-block"></i><span class="xsmall">My Notices</span></a>
    <a class="nav-link" data-link="create" href="#"><i class="bi bi-plus-circle fs-5 d-block"></i><span class="xsmall">Create</span></a>
    <a class="nav-link" data-link="profile" href="#"><i class="bi bi-person fs-5 d-block"></i><span class="xsmall">Profile</span></a>
    <button class="nav-link border-0 bg-transparent" id="toggleThemeBottom"><i class="bi bi-moon-stars fs-5 d-block"></i><span class="xsmall">Theme</span></button>
  </nav>

  <script>
    /*************** THEME ***************/
    function applyTheme(){ const t = localStorage.getItem('theme')||'light'; document.documentElement.setAttribute('data-theme',t); document.body.setAttribute('data-theme',t); }
    function toggleTheme(){ const t = localStorage.getItem('theme')||'light'; const n = t==='light'?'dark':'light'; localStorage.setItem('theme',n); applyTheme(); }

    /*************** STORAGE KEYS ***************/
    const NOTICES_KEY = 'notices'; // shared with student page so students can see staff-published items
    const STAFF_PROFILE_KEY = 'staff_profile';

    /*************** PROFILE ***************/
    function getStaffProfile(){
      const p = JSON.parse(localStorage.getItem(STAFF_PROFILE_KEY)||'null');
      return p || { name:'Staff Name', dept:'Department', email:'', phone:'', photo:null };
    }
    function saveStaffProfile(p){ localStorage.setItem(STAFF_PROFILE_KEY, JSON.stringify(p)); }

    function updateStaffAvatars(){
      const p = getStaffProfile();
      const initials = (p.name||'ST').split(' ').map(s=>s[0]).join('').slice(0,2).toUpperCase();
      const sidebarAvatar = document.getElementById('sidebarAvatar');
      if(p.photo){ sidebarAvatar.innerHTML = `<img src="${p.photo}" alt="avatar">`; } else { sidebarAvatar.textContent = initials; }
      document.getElementById('sidebarName').textContent = p.name || 'Staff Name';
      document.getElementById('sidebarDept').textContent = p.dept || 'Department';
      const profileAvatar = document.getElementById('profileAvatar');
      if(p.photo){ profileAvatar.innerHTML = `<img src="${p.photo}" alt="avatar">`; } else { profileAvatar.textContent = initials; }
      
      // Topbar profile avatar (mobile)
      const topbarAvatarEl = document.getElementById('topbarProfileAvatar');
      const topbarImgEl = document.getElementById('topbarProfileImg');
      if(topbarAvatarEl) {
        if(p.photo && topbarImgEl) {
          topbarImgEl.src = p.photo;
          topbarImgEl.style.display = 'block';
          topbarImgEl.style.position = 'absolute';
          topbarAvatarEl.textContent = '';
        } else {
          if(topbarImgEl) {
            topbarImgEl.style.display = 'none';
            topbarImgEl.src = '';
          }
          topbarAvatarEl.textContent = initials;
        }
      }
    }

    /*************** NOTICES ***************/
    function getAllNotices(){
      const list = JSON.parse(localStorage.getItem(NOTICES_KEY)||'null');
      return Array.isArray(list) ? list : [];
    }
    function saveAllNotices(list){ localStorage.setItem(NOTICES_KEY, JSON.stringify(list)); }

    function currentStaffId(){ // simple pseudo-id based on name
      const p = getStaffProfile();
      return (p.name||'staff').toLowerCase().replace(/\s+/g,'_');
    }

    function myNotices(){
      const me = currentStaffId();
      return getAllNotices().filter(n => n.createdBy === me);
    }

    function upsertNotice(payload){
      const list = getAllNotices();
      if(payload.id){
        const idx = list.findIndex(n=>n.id===payload.id);
        if(idx>-1){ list[idx] = payload; } else { list.push(payload); }
      } else {
        payload.id = Date.now();
        list.push(payload);
      }
      saveAllNotices(list);
      return payload.id;
    }

    function deleteNotice(id){
      const list = getAllNotices().filter(n=>n.id!==id);
      saveAllNotices(list);
    }

    /*************** RENDER – MY NOTICES ***************/
    function renderMyNotices(){
      const tbody = document.getElementById('tableMyNotices');
      const cards = document.getElementById('cardsMyNotices');
      const statusSel = document.getElementById('statusFilter').value;
      const catSel = document.getElementById('categoryFilter').value;
      const q = (document.getElementById('searchInput').value||'').toLowerCase();

      const filtered = myNotices().filter(n => {
        const okStatus = statusSel==='all' || n.status===statusSel;
        const okCat = catSel==='all' || n.category===catSel;
        const okText = n.title.toLowerCase().includes(q) || n.content.toLowerCase().includes(q);
        return okStatus && okCat && okText;
      });

      // table
      if(tbody){
        tbody.innerHTML = filtered.map(n=>`
          <tr>
            <td>${n.title}</td>
            <td>${n.category}</td>
            <td><span class="badge rounded-pill bg-light text-dark badge-status">${n.status}</span></td>
            <td>${new Date(n.createdAt).toLocaleDateString()}</td>
            <td>${n.publishAt ? new Date(n.publishAt).toLocaleString() : '-'}</td>
            <td class="text-end">
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-secondary" data-action="edit" data-id="${n.id}"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-outline-danger" data-action="del" data-id="${n.id}"><i class="bi bi-trash"></i></button>
              </div>
            </td>
          </tr>`).join('');
        tbody.querySelectorAll('button[data-action]').forEach(b=>{
          const id = Number(b.dataset.id);
          b.addEventListener('click',()=>{
            if(b.dataset.action==='edit'){ editNotice(id); }
            if(b.dataset.action==='del'){ confirmDelete(id); }
          });
        });
      }

      // cards
      if(cards){
        cards.innerHTML = filtered.map(n=>`
          <div class="col-12">
            <div class="card-soft p-3">
              <div class="d-flex justify-content-between">
                <div>
                  <div class="fw-semibold">${n.title}</div>
                  <div class="xsmall text-muted">${n.category} • ${new Date(n.createdAt).toLocaleDateString()}</div>
                </div>
                <span class="badge rounded-pill bg-light text-dark badge-status align-self-start">${n.status}</span>
              </div>
              <p class="mt-2 mb-2">${n.content.substring(0,140)}${n.content.length>140?'…':''}</p>
              <div class="d-flex justify-content-end gap-2">
                <button class="btn btn-sm btn-outline-secondary" data-action="edit" data-id="${n.id}"><i class="bi bi-pencil me-1"></i>Edit</button>
                <button class="btn btn-sm btn-outline-danger" data-action="del" data-id="${n.id}"><i class="bi bi-trash me-1"></i>Delete</button>
              </div>
            </div>
          </div>`).join('');
        cards.querySelectorAll('button[data-action]').forEach(b=>{
          const id = Number(b.dataset.id);
          b.addEventListener('click',()=>{
            if(b.dataset.action==='edit'){ editNotice(id); }
            if(b.dataset.action==='del'){ confirmDelete(id); }
          });
        });
      }
    }

    function editNotice(id){
      const n = getAllNotices().find(x=>x.id===id);
      if(!n) return;
      document.getElementById('formTitle').textContent = 'Edit Notice';
      document.getElementById('noticeId').value = n.id;
      document.getElementById('n_title').value = n.title;
      document.getElementById('n_category').value = n.category;
      document.getElementById('n_department').value = n.department;
      document.getElementById('n_status').value = n.status;
      document.getElementById('n_pinned').value = String(!!n.pinned);
      document.getElementById('n_publish_at').value = n.publishAt ? new Date(n.publishAt).toISOString().slice(0,16) : '';
      document.getElementById('n_expire_at').value = n.expireAt ? new Date(n.expireAt).toISOString().slice(0,10) : '';
      document.getElementById('n_content').value = n.content;
      showSection('create');
    }

    function confirmDelete(id){
      const modalHtml = `
      <div class="modal fade" id="delModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content" style="background:var(--card);color:var(--text)">
            <div class="modal-header"><h5 class="modal-title">Delete Notice</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">Are you sure you want to delete this notice?</div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-danger" id="confirmDelBtn">Delete</button>
            </div>
          </div>
        </div>
      </div>`;
      const temp = document.createElement('div'); temp.innerHTML = modalHtml; document.body.appendChild(temp.firstElementChild);
      const el = document.getElementById('delModal'); const m = new bootstrap.Modal(el); m.show();
      el.querySelector('#confirmDelBtn').addEventListener('click',()=>{ deleteNotice(id); m.hide(); renderMyNotices(); alert('Notice deleted.'); el.remove(); });
      el.addEventListener('hidden.bs.modal',()=> el.remove());
    }

    /*************** SECTION NAV ***************/
    const sections = ['myNotices','create','profile'];
    function showSection(key){
      sections.forEach(id=>{ const el = document.getElementById('section-'+id); if(el) el.hidden = (id!==key); });
      document.querySelectorAll('[data-link]').forEach(a=>{ a.classList.toggle('active', a.dataset.link===key); });
      if(key==='myNotices') renderMyNotices();
      if(key==='profile') loadProfileForm();
      if(key==='create') prepareCreateForm();
    }

    /*************** CREATE/EDIT FORM ***************/
    function prepareCreateForm(){
      // if coming from "+ Create" ensure clean state when no id
      const id = document.getElementById('noticeId').value;
      document.getElementById('formTitle').textContent = id ? 'Edit Notice' : 'Create Notice';
    }

    function collectFormData(asDraft=false){
      const p = getStaffProfile();
      const title = document.getElementById('n_title').value.trim();
      const category = document.getElementById('n_category').value;
      const department = document.getElementById('n_department').value.trim();
      const status = asDraft ? 'draft' : document.getElementById('n_status').value;
      const pinned = document.getElementById('n_pinned').value === 'true';
      const publishAt = document.getElementById('n_publish_at').value ? new Date(document.getElementById('n_publish_at').value).toISOString() : null;
      const expireAt = document.getElementById('n_expire_at').value ? new Date(document.getElementById('n_expire_at').value).toISOString() : null;
      const content = document.getElementById('n_content').value.trim();
      const idStr = document.getElementById('noticeId').value;
      if(!title || !category || !department || !content){ throw new Error('Please fill in all required fields.'); }
      const payload = {
        id: idStr? Number(idStr): null,
        title, category, department, status, pinned,
        publishAt, expireAt, content,
        createdAt: idStr? getAllNotices().find(x=>x.id===Number(idStr))?.createdAt || new Date().toISOString() : new Date().toISOString(),
        createdBy: currentStaffId(),
        authorName: p.name || 'Staff',
      };
      return payload;
    }

    /*************** PROFILE FORM ***************/
    function loadProfileForm(){
      const p = getStaffProfile();
      document.getElementById('p_name').value = p.name||'';
      document.getElementById('p_dept').value = p.dept||'';
      document.getElementById('p_email').value = p.email||'';
      document.getElementById('p_phone').value = p.phone||'';
      updateStaffAvatars();
    }

    function handlePhoto(file){
      if(!file) return; if(!file.type.startsWith('image/')){ alert('Please select an image.'); return; }
      if(file.size > 5*1024*1024){ alert('Image size should be < 5MB.'); return; }
      const r = new FileReader();
      r.onload = () => { const p = getStaffProfile(); p.photo = r.result; saveStaffProfile(p); updateStaffAvatars(); alert('Photo uploaded successfully.'); };
      r.onerror = () => alert('Error reading image.');
      r.readAsDataURL(file);
    }

    /*************** INIT ***************/
    document.addEventListener('DOMContentLoaded',()=>{
      applyTheme();
      document.getElementById('toggleThemeTop').addEventListener('click', toggleTheme);
      document.getElementById('toggleThemeSide').addEventListener('click', toggleTheme);
      document.getElementById('toggleThemeBottom').addEventListener('click', toggleTheme);

      // nav
      document.querySelectorAll('[data-link]').forEach(el=> el.addEventListener('click', (e)=>{ e.preventDefault(); showSection(el.dataset.link); window.scrollTo({top:0,behavior:'smooth'}); }));

      // filters & search
      ['statusFilter','categoryFilter'].forEach(id=> document.getElementById(id).addEventListener('change', renderMyNotices));
      document.getElementById('searchInput').addEventListener('input', renderMyNotices);

      // profile
      document.getElementById('photoInput').addEventListener('change', e=> handlePhoto(e.target.files[0]));
      document.getElementById('profileForm').addEventListener('submit', e=>{
        e.preventDefault();
        const p = {
          name: document.getElementById('p_name').value.trim() || 'Staff Name',
          dept: document.getElementById('p_dept').value.trim() || 'Department',
          email: document.getElementById('p_email').value.trim(),
          phone: document.getElementById('p_phone').value.trim(),
          photo: getStaffProfile().photo || null
        };
        saveStaffProfile(p); updateStaffAvatars(); alert('Profile updated successfully.');
      });
      document.getElementById('resetProfile').addEventListener('click', ()=>{ localStorage.removeItem(STAFF_PROFILE_KEY); updateStaffAvatars(); loadProfileForm(); });

      // create/edit form
      document.getElementById('btnCancel').addEventListener('click', ()=>{ document.getElementById('noticeForm').reset(); document.getElementById('noticeId').value=''; showSection('myNotices'); });
      document.getElementById('btnSaveDraft').addEventListener('click', ()=>{
        try{ const payload = collectFormData(true); const id = upsertNotice(payload); document.getElementById('noticeId').value = id; alert('Draft saved.'); showSection('myNotices'); }
        catch(err){ alert(err.message); }
      });
      document.getElementById('noticeForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        try{ const payload = collectFormData(false); upsertNotice(payload); alert('Notice saved.'); showSection('myNotices'); }
        catch(err){ alert(err.message); }
      });

      // initial UI
      updateStaffAvatars();
      renderMyNotices();
      showSection('myNotices');
    });

    function logout(){ alert('Logged out successfully.'); window.location.href = './index.html'; }
  </script>
</body>
</html>
